(function(e){var t=navigator.platform,n=null,r="iPad"===t||"iPhone"===t||"iPod"===t,i="undefined"!=typeof InstallTrigger,s=function(t,n){if(null!==n&&"undefined"!=typeof n)for(var r in n)e(t).data("autotab-"+r,n[r])},o=function(t){var n={format:"all",loaded:!1,disabled:!1,pattern:null,uppercase:!1,lowercase:!1,nospace:!1,maxlength:2147483647,target:null,previous:null,trigger:null,originalValue:"",changed:!1},r;for(r in n)n[r]=e(t).data("autotab-"+r)||n[r];return n.loaded||(null!==n.trigger&&"string"==typeof n.trigger&&(n.trigger=n.trigger.toString()),s(t,n)),n};e.autotab={next:function(){var t=e(document.activeElement);t.length&&t.trigger("autotab-next")},previous:function(){var t=e(document.activeElement);t.length&&t.trigger("autotab-previous")}},e.fn.autotab=function(t,n){if(!this.length)return this;if("filter"==t){if("string"==typeof n||"function"==typeof n)n={format:n};for(var r=0,i=this.length;r<i;r++){var u=o(this[r]),f=n;f.target=u.target,f.previous=u.previous,e.extend(u,f),s(this[r],u)}}else if("remove"==t||"destroy"==t||"disable"==t)for(r=0,i=this.length;r<i;r++)u=o(this[r]),u.disabled=!0,s(this[r],u);else if("restore"==t||"enable"==t)for(r=0,i=this.length;r<i;r++)u=o(this[r]),u.disabled=!1,s(this[r],u);else if(null===t||"undefined"==typeof t?n={}:"string"==typeof t||"function"==typeof t?n={format:t}:"object"==typeof t&&(n=t),1<this.length)for(r=0,i=this.length;r<i;r++){var u=r+1,l=r-1,f=n;0<r&&u<i?(f.target=this[u],f.previous=this[l]):0<r?(f.target=null,f.previous=this[l]):(f.target=this[u],f.previous=null),a(this[r],f)}else a(this[0],n);return this};var u=function(e,t,n){if("function"==typeof n.format)return n.format(t,e);e=null;switch(n.format){case"text":e=RegExp("[0-9]+","g");break;case"alpha":e=RegExp("[^a-zA-Z]+","g");break;case"number":case"numeric":e=RegExp("[^0-9]+","g");break;case"alphanumeric":e=RegExp("[^0-9a-zA-Z]+","g");break;case"hex":case"hexadecimal":e=RegExp("[^0-9A-Fa-f]+","g");break;case"custom":e=RegExp(n.pattern,"g")}return null!==e&&(t=t.replace(e,"")),n.nospace&&(e=RegExp("[ ]+","g"),t=t.replace(e,"")),n.uppercase&&(t=t.toUpperCase()),n.lowercase&&(t=t.toLowerCase()),t},a=function(t,a){var f=o(t);f.disabled&&(f.disabled=!1,f.target=null,f.previous=null),e.extend(f,a),"string"!=typeof f.target&&f.target instanceof jQuery||(f.target=e(f.target)),"string"!=typeof f.previous&&f.previous instanceof jQuery||(f.previous=e(f.previous));var l=t.maxLength;2147483647==f.maxlength&&2147483647!=l&&-1!=l?f.maxlength=l:0<f.maxlength?t.maxLength=f.maxlength:f.target=null,f.loaded?s(t,f):(f.loaded=!0,s(t,f),e(t).on("autotab-next",function(e,t){var i=this;setTimeout(function(){t||(t=o(i)),t.disabled||!t.target.length||r||(t.target.focus().select(),n=new Date)},1)}).on("autotab-previous",function(e,t){var r=this;setTimeout(function(){t||(t=o(r));var e=t.previous;if(!t.disabled&&e.length){var i=e.val();i.length?(e.focus().val(i.substring(0,i.length-1)),s(e,{changed:!0})):e.focus(),n=null}},1)}).on("focus",function(){s(this,{originalValue:this.value})}).on("blur",function(){var t=o(this);t.changed&&this.value!=t.originalValue&&(s(this,{changed:!1}),e(this).change())}).on("keydown",function(t){var r=o(this);if(!r||r.disabled)return!0;var i=t.which||t.charCode;if(8==i)0===this.value.length&&r.previous.length?e(this).trigger("autotab-previous",r):s(this,{changed:this.value!=r.originalValue});else if(9==i&&null!==n)if(t.shiftKey)n=null;else if(800>(new Date).getTime()-n.getTime())return n=null,!1}).on("keypress",function(t){var r=o(this),a=t.which||t.keyCode;if(!r||r.disabled||i&&0===t.charCode||t.ctrlKey||t.altKey||13==a||"text"!=this.type)return!0;a=String.fromCharCode(a);if(null!==r.trigger&&0<=r.trigger.indexOf(a))return null!==n&&800>(new Date).getTime()-n.getTime()?n=null:e(this).trigger("autotab-next",r),!1;n=null,t=document.selection&&document.selection.createRange?!0:0<t.charCode,a=u(this,a,r);if(!t||null!==a&&""!==a){if(t&&this.value.length<=this.maxLength){var f,l;t=0;if("number"==typeof this.selectionStart&&"number"==typeof this.selectionEnd)f=this.selectionStart,l=this.selectionEnd,t=1;else if(document.selection&&document.selection.createRange){l=document.selection.createRange(),f=this.createTextRange(),t=this.createTextRange();var c=l.getBookmark();f.moveToBookmark(c),t.setEndPoint("EndToStart",f),f=t.text.length,l=f+l.text.length,t=2}if(0===f&&l==this.value.length)this.value=a,s(this,{changed:this.value!=r.originalValue});else{if(this.value.length==this.maxLength)return e(this).trigger("autotab-next",r),!1;this.value=this.value.slice(0,f)+a+this.value.slice(l),s(this,{changed:this.value!=r.originalValue}),this.value.length!=r.maxlength&&(f++,1==t?this.selectionStart=this.selectionEnd=f:2==t&&(a=this.createTextRange(),a.collapse(!0),a.moveEnd("character",f),a.moveStart("character",f),a.select()))}}return this.value.length==r.maxlength&&e(this).trigger("autotab-next",r),!1}return!1}).on("paste",function(t){var n=o(this);if(!n)return!0;this.maxLength=2147483647,function(t,i){setTimeout(function(){var s=-1,a=document.createElement("input");a.type="hidden",a.value=t.value.toLowerCase(),t.maxLength=i.maxlength,t.value=u(t,t.value,i).substr(0,i.maxlength);var f=function(t,n){if(t){for(var i=0,l=n.length;i<l;i++)s=a.value.indexOf(n.charAt(i),s)+1;i=o(t),l=a.value.substr(s),(l=u(t,l,i).substr(0,i.maxlength))?(t.value=l,l.length==i.maxlength&&(e(t).trigger("autotab-next",i),r||f(i.target[0],l))):t.value=""}};t.value.length==i.maxlength&&(e(t).trigger("autotab-next",n),r||f(i.target[0],t.value.toLowerCase()))},1)}(this,n)}))};e.fn.autotab_magic=function(t){e(this).autotab()},e.fn.autotab_filter=function(t){var n={};"string"==typeof t||"function"==typeof t?n.format=t:e.extend(n,t),e(this).autotab("filter",n)}})(jQuery);